<%= form_with url: onboarding_step_path(@step), method: :post, local: true, class: "space-y-6" do |form| %>
  <div>
    <div class="flex items-center mb-4">
      <div class="flex-shrink-0">
        <svg class="h-8 w-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
        </svg>
      </div>
      <div class="ml-4">
        <h3 class="text-lg font-medium text-gray-900">Connect AI Providers</h3>
        <p class="text-sm text-gray-600">Set up AI integrations to supercharge your workflow.</p>
      </div>
    </div>

    <% if step_data[:has_ai_config] %>
      <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
        <div class="flex">
          <div class="flex-shrink-0">
            <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="ml-3">
            <h4 class="text-sm font-medium text-green-800">AI providers already configured</h4>
            <p class="text-sm text-green-700">Great! You already have AI providers set up. You can continue to the next step.</p>
          </div>
        </div>
      </div>
    <% else %>
      <div class="space-y-6">
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <div class="ml-3">
              <h4 class="text-sm font-medium text-blue-800">Powerful AI Features</h4>
              <p class="text-sm text-blue-700">
                Connect to leading AI providers to unlock intelligent features and automation.
              </p>
            </div>
          </div>
        </div>

        <div>
          <%= form.label :ai_provider, "Choose Your AI Provider", class: "block text-sm font-medium text-gray-700 mb-3" %>
          
          <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
            <div class="relative rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-sm flex items-center space-x-3 hover:border-gray-400 focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
              <div class="flex-shrink-0">
                <div class="h-8 w-8 bg-green-100 rounded-lg flex items-center justify-center">
                  <span class="text-green-600 font-semibold text-xs">GPT</span>
                </div>
              </div>
              <div class="flex-1 min-w-0">
                <div class="focus:outline-none">
                  <span class="absolute inset-0" aria-hidden="true"></span>
                  <p class="text-sm font-medium text-gray-900">OpenAI</p>
                  <p class="text-sm text-gray-500">GPT-4, GPT-3.5 Turbo</p>
                </div>
              </div>
              <div class="flex-shrink-0">
                <input type="radio" name="ai[provider]" value="openai" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
              </div>
            </div>

            <div class="relative rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-sm flex items-center space-x-3 hover:border-gray-400 focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
              <div class="flex-shrink-0">
                <div class="h-8 w-8 bg-orange-100 rounded-lg flex items-center justify-center">
                  <span class="text-orange-600 font-semibold text-xs">AI</span>
                </div>
              </div>
              <div class="flex-1 min-w-0">
                <div class="focus:outline-none">
                  <span class="absolute inset-0" aria-hidden="true"></span>
                  <p class="text-sm font-medium text-gray-900">Anthropic</p>
                  <p class="text-sm text-gray-500">Claude 3 Opus, Sonnet</p>
                </div>
              </div>
              <div class="flex-shrink-0">
                <input type="radio" name="ai[provider]" value="anthropic" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
              </div>
            </div>

            <div class="relative rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-sm flex items-center space-x-3 hover:border-gray-400 focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
              <div class="flex-shrink-0">
                <div class="h-8 w-8 bg-blue-100 rounded-lg flex items-center justify-center">
                  <span class="text-blue-600 font-semibold text-xs">G</span>
                </div>
              </div>
              <div class="flex-1 min-w-0">
                <div class="focus:outline-none">
                  <span class="absolute inset-0" aria-hidden="true"></span>
                  <p class="text-sm font-medium text-gray-900">Google</p>
                  <p class="text-sm text-gray-500">Gemini Pro, PaLM</p>
                </div>
              </div>
              <div class="flex-shrink-0">
                <input type="radio" name="ai[provider]" value="google" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
              </div>
            </div>

            <div class="relative rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-sm flex items-center space-x-3 hover:border-gray-400 focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
              <div class="flex-shrink-0">
                <div class="h-8 w-8 bg-gray-100 rounded-lg flex items-center justify-center">
                  <span class="text-gray-600 font-semibold text-xs">?</span>
                </div>
              </div>
              <div class="flex-1 min-w-0">
                <div class="focus:outline-none">
                  <span class="absolute inset-0" aria-hidden="true"></span>
                  <p class="text-sm font-medium text-gray-900">Skip for now</p>
                  <p class="text-sm text-gray-500">Configure later</p>
                </div>
              </div>
              <div class="flex-shrink-0">
                <input type="radio" name="ai[provider]" value="skip" checked class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
              </div>
            </div>
          </div>
        </div>

        <div id="api-key-field" class="hidden">
          <div>
            <%= form.label :api_key, "API Key", class: "block text-sm font-medium text-gray-700" %>
            <%= form.password_field "ai[api_key]", 
                placeholder: "Enter your API key...",
                class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" %>
            <p class="mt-1 text-xs text-gray-500">Your API key will be encrypted and stored securely.</p>
          </div>
          
          <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-4">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
              </div>
              <div class="ml-3">
                <h4 class="text-sm font-medium text-yellow-800">How to get your API key</h4>
                <div class="mt-1 text-sm text-yellow-700">
                  <p id="api-instructions">Select a provider to see specific instructions.</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="space-y-4">
          <h4 class="text-sm font-medium text-gray-900">What you can do with AI:</h4>
          <ul class="text-sm text-gray-600 space-y-2">
            <li class="flex items-center">
              <svg class="h-4 w-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
              </svg>
              Generate content and suggestions
            </li>
            <li class="flex items-center">
              <svg class="h-4 w-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
              </svg>
              Automate repetitive tasks
            </li>
            <li class="flex items-center">
              <svg class="h-4 w-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
              </svg>
              Analyze and summarize data
            </li>
            <li class="flex items-center">
              <svg class="h-4 w-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
              </svg>
              Smart search and recommendations
            </li>
          </ul>
        </div>
      </div>
    <% end %>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const radios = document.querySelectorAll('input[name="ai[provider]"]');
      const apiKeyField = document.getElementById('api-key-field');
      const instructions = document.getElementById('api-instructions');
      
      const instructionsMap = {
        'openai': 'Visit <a href="https://platform.openai.com/api-keys" target="_blank" class="text-blue-600 hover:text-blue-500">platform.openai.com/api-keys</a> to create your API key.',
        'anthropic': 'Visit <a href="https://console.anthropic.com/" target="_blank" class="text-blue-600 hover:text-blue-500">console.anthropic.com</a> to get your API key.',
        'google': 'Visit <a href="https://makersuite.google.com/app/apikey" target="_blank" class="text-blue-600 hover:text-blue-500">makersuite.google.com</a> to create your API key.',
        'skip': 'You can configure AI providers later from your settings.'
      };
      
      radios.forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'skip') {
            apiKeyField.classList.add('hidden');
          } else {
            apiKeyField.classList.remove('hidden');
          }
          
          instructions.innerHTML = instructionsMap[this.value] || 'Select a provider to see instructions.';
        });
      });
    });
  </script>
<% end %>