<div class="mb-8">
  <div class="flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Edit Fallback AI Credential</h1>
      <p class="text-gray-600 mt-2">Update shared API key configuration</p>
    </div>
    <%= link_to "← Back", admin_fallback_ai_credential_path(@fallback_credential), class: "text-blue-600 hover:text-blue-800" %>
  </div>
</div>

<div class="bg-white shadow rounded-lg p-6 max-w-4xl">
  <%= form_with model: [:admin, @fallback_credential], local: true, class: "space-y-6" do |f| %>
    <% if @fallback_credential.errors.any? %>
      <div class="bg-red-50 border border-red-200 rounded p-4">
        <h3 class="text-red-800 font-medium">Please fix the following errors:</h3>
        <ul class="mt-2 text-red-700 text-sm">
          <% @fallback_credential.errors.full_messages.each do |message| %>
            <li>• <%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- Basic Information -->
    <div class="border-b border-gray-200 pb-6">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Basic Information</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <%= f.label :name, class: "block text-sm font-medium text-gray-700" %>
          <%= f.text_field :name, class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm" %>
        </div>
        
        <div>
          <%= f.label :ai_provider_id, "AI Provider", class: "block text-sm font-medium text-gray-700" %>
          <%= f.select :ai_provider_id, 
                       options_from_collection_for_select(@ai_providers, :id, :name, @fallback_credential.ai_provider_id),
                       { prompt: "Select a provider" },
                       { class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm" } %>
        </div>
        
        <div class="md:col-span-2">
          <%= f.label :description, class: "block text-sm font-medium text-gray-700" %>
          <%= f.text_area :description, rows: 3, 
                         class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm" %>
        </div>
      </div>
    </div>

    <!-- API Configuration -->
    <div class="border-b border-gray-200 pb-6">
      <h3 class="text-lg font-medium text-gray-900 mb-4">API Configuration</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <%= f.label :api_key, class: "block text-sm font-medium text-gray-700" %>
          <%= f.password_field :api_key, class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm", 
                              placeholder: "Leave empty to keep current key" %>
          <p class="mt-1 text-sm text-gray-500">Leave empty to keep current API key</p>
        </div>
        
        <div>
          <%= f.label :preferred_model, class: "block text-sm font-medium text-gray-700" %>
          <%= f.text_field :preferred_model, class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm" %>
        </div>
        
        <div>
          <%= f.label :temperature, class: "block text-sm font-medium text-gray-700" %>
          <%= f.number_field :temperature, step: 0.1, min: 0, max: 2, 
                            class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm" %>
        </div>
        
        <div>
          <%= f.label :max_tokens, class: "block text-sm font-medium text-gray-700" %>
          <%= f.number_field :max_tokens, min: 1, max: 100000, 
                            class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm" %>
        </div>
        
        <div>
          <%= f.label :response_format, class: "block text-sm font-medium text-gray-700" %>
          <%= f.select :response_format, 
                       options_for_select([['Text', 'text'], ['JSON', 'json'], ['Markdown', 'markdown'], ['HTML', 'html']], 
                                         @fallback_credential.response_format),
                       {}, { class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm" } %>
        </div>
        
        <div>
          <%= f.label :priority, class: "block text-sm font-medium text-gray-700" %>
          <%= f.number_field :priority, min: 0, 
                            class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm" %>
          <p class="mt-1 text-sm text-gray-500">Lower number = higher priority</p>
        </div>
      </div>
      
      <div class="mt-6">
        <%= f.label :system_prompt, class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_area :system_prompt, rows: 4, 
                       class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm" %>
      </div>
    </div>

    <!-- Usage Limits -->
    <div class="border-b border-gray-200 pb-6">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Usage Limits</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <%= f.label :daily_limit, class: "block text-sm font-medium text-gray-700" %>
          <%= f.number_field :daily_limit, min: 1, 
                            class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm",
                            placeholder: "Leave empty for unlimited" %>
          <p class="mt-1 text-sm text-gray-500">Daily API calls per user</p>
        </div>
        
        <div>
          <%= f.label :usage_limit, class: "block text-sm font-medium text-gray-700" %>
          <%= f.number_field :usage_limit, min: 1, 
                            class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm",
                            placeholder: "Leave empty for unlimited" %>
          <p class="mt-1 text-sm text-gray-500">Total API calls per user</p>
        </div>
        
        <div class="md:col-span-2">
          <%= f.label :expires_at, "Expiration Date", class: "block text-sm font-medium text-gray-700" %>
          <%= f.datetime_local_field :expires_at, 
                                    value: @fallback_credential.expires_at&.strftime("%Y-%m-%dT%H:%M"),
                                    class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm" %>
          <p class="mt-1 text-sm text-gray-500">Optional expiration date for this credential</p>
        </div>
      </div>
    </div>

    <!-- Trial Configuration -->
    <div class="border-b border-gray-200 pb-6">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Trial Configuration</h3>
      <div class="space-y-4">
        <div class="flex items-center">
          <%= f.check_box :enabled_for_trials, class: "mr-3 rounded border-gray-300" %>
          <%= f.label :enabled_for_trials, "Enable for trial users", class: "text-sm font-medium text-gray-700" %>
        </div>
        
        <div class="flex items-center">
          <%= f.check_box :enabled_for_onboarding, class: "mr-3 rounded border-gray-300" %>
          <%= f.label :enabled_for_onboarding, "Show in onboarding flow", class: "text-sm font-medium text-gray-700" %>
        </div>
        
        <div class="flex items-center">
          <%= f.check_box :active, class: "mr-3 rounded border-gray-300" %>
          <%= f.label :active, "Active", class: "text-sm font-medium text-gray-700" %>
        </div>
        
        <div>
          <%= f.label :onboarding_message, class: "block text-sm font-medium text-gray-700" %>
          <%= f.text_area :onboarding_message, rows: 3, 
                         class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm" %>
        </div>
      </div>
    </div>

    <!-- Submit -->
    <div class="flex justify-end space-x-3">
      <%= link_to "Cancel", admin_fallback_ai_credential_path(@fallback_credential), 
                  class: "bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700" %>
      <%= f.submit "Update Credential", class: "bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" %>
    </div>
  <% end %>
</div>